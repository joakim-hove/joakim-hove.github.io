Introduction to ERT and Ensemble based methods
==============================================

The reservoir model for a green field is based on a range subsurface input
including seismic data, a geological concept, well logs and fluid samples. All
of this data is uncertain, and it is quite obvious that the resulting reservoir
model is quite uncertain. Although uncertain reservoir models are still the only
tool we have when we make reservoir management decisions for the future.

Since reservoir models are very important for future predictions there is much
focus on reducing the uncertainty in the models. When the field has been in
production for some time one can use true data assembled from the producing
field to update the model. This process is commonly called *history matching* in
the petroleum industry, in this manual we will use the term *model updating*.
Before the model updating process can start you will need:

1. Observation data from the producing field :math:`d`. 
2. A reservoir model which has been *parameterized* with a parameter set :math:`\{\lambda\}`. 

Then the the actual model updating goes like this:

1. Simulate the behaviour of the field and assemble simulated data :math:`s`. 
2. Compare the simulated simulated data :math:`s` with the observed data :math:`d`. 
3. Based on the misfit between :math:`s` and :math:`d` updated parameters are
   :math:`\{\lambda'\}` are calculated.   

Model updating falls into the general category of *inverse problems* - i.e. we
know the results and want to determine the input parameters which gave rise to
these results.


It is very important to remember that the sole reason for doing model updating
is to be able to make better predictions for the future, the history has
happened already anyway!


Embrace the uncertainty
-----------------------

Ensemble Kalman Filter - EnKF
-----------------------------

The ERT application was originally devised created to do model updating of
reservoir models with the EnKF algorithm. The experience from real world models
was that EnKF was not very suitable for reservoir applications, and ERT has
since changed to the Ensemble Smoother (ES) which can be said to be a simplified
version of the EnKF. But the characteristics of the EnKF algorithm still
influence many of the design decisions in ERT, it therefor makes sense to give a
short introduction to the Kalman Filter and EnKF.

The Kalman Filter
~~~~~~~~~~~~~~~~~

The Kalman FIlter originates in electronics the 60's. The Kalman filter is
*widely* used, especially in applications where positioning is the goal - e.g.
the GPS system. The typical ingredients where the Kalman filter can be
interesting to try include:

1. We want to determine the final *state* of the system - this can typically the
   the position.

2. The starting position is uncertain.

3. There is an *equation of motion* - or *forward model* - which describes how
   the system evolves in time.

4. At fixed point in time we can *observe* the system, these observations are
   uncertain.

As a very simple application of the Kalman Filter, assume that we wish to
estimate the position of a boat as :math:`x(t)`; we know where the boat starts
(initial condition), we have an equation for how the boat moves with time and at
selected points in time :math:`t_k` we get *measurements* of the position. The
quantities of interest are:

:math:`x_k`
   The estimated position at time :math:`t_k`.

:math:`\sigma_k`
   The uncertainty in the position at time :math:`t_k`.

:math:`x_k^{\ast}`
   The *estimated/forecasted* position at time :math:`t_k` -
   this is the position estimated from :math:`x_{k-1}` and :math:`f(x,t)`, but
   before the observed data :math:`d_k` is taken into account.

:math:`f(x,t)`
   The equation of motion - *forward model* - which propagates
      :math:`x_{k-1} \to x_k^{\ast}` 

The purpose of the Kalman Filter is to determine an updated :math:`x_k` from
:math:`x_{k-1}` and :math:`d_k`. The updated :math:`x_k` is the value which
*minimizes the variance* :math:`\sigma_k`. The equations for updated position
and uncertainty are:

.. math::
   x_k &= x_k^{\ast}\frac{\sigma_d^2}{\sigma_k^2 + \sigma_d^2} + x_d
   \frac{\sigma_k^2}{\sigma_k^2 + \sigma_d^2}

.. math::          
   \sigma_k &= 1092


Looking 

.. figure:: images/apollo.jpg
   :scale: 20%

   The engineers at NASA used the Kalman Filter when designing the navigation
   systems for the Apollo space program. 


Using an ensemble to estimate the uncertainty: EnKF
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 
   
    

Ensemble Smoother - ES
----------------------



